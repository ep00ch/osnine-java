*
* Random Block File manager definitions included
*

 opt -l

*****
*
*  RANDOM BLOCK PATH DESCRIPTOR FORMAT
*
 ORG PD.FST
PD.SMF RMB 1 STATE FLAGS
PD.CP RMB 4 CURRENT LOGICAL BYTE POSITION
PD.SIZ RMB 4 FILE SIZE
PD.SBL RMB 3 SEGMENT BEGINNING LSN
PD.SBP RMB 3 SEGMENT BEGINNING PSN
PD.SSZ RMB 2 SEGMENT SIZE
PD.DSK RMB 2 DISK ID
PD.DTB RMB 2 DRIVE TABLE PTR
 ORG PD.OPT
 RMB 1 DEVICE TYPE
PD.DRV RMB 1 DRIVE NUMBER
PD.STP RMB 1 STEP RATE
PD.TYP RMB 1 DISK DEVICE TYPE (5" 8" OTHER)
PD.DNS RMB 1 DENSITY CAPABILITY
PD.CYL RMB 2 NUMBER OF CYLINDERS
PD.SID RMB 1 NUMBER OF SURFACES
PD.VFY RMB 1 0=verify disk writes
PD.SCT RMB 2 Default Sectors/Track
PD.T0S RMB 2 Default Sectors/Track TR00,S0
PD.ILV RMB 1 Sector Interleave Offset
PD.SAS RMB 1 Segment Allocation Size
 RMB PDSIZE-.-13
PD.ATT RMB 1 FILE ATTRIBUTES
PD.FD RMB 3 FILE DESCRIPTOR PSN
PD.DFD RMB 3 DIRECTORY FILE DESCRIPTOR PSN
PD.DCP RMB 4 FILE DIRECTORY ENTRY PTR
PD.DVT RMB 2 USER READABLE DEV TBL PTR

* STATE FLAGS
BUFMOD EQU 1 BUFFER MODIFIED
SINBUF EQU 2 SECTOR IN BUFFER
FDBUF EQU 4 FILE DESCRIPTOR IN BUFFER
EOFSEC EQU 8 END OF FILE SECTOR
EOF EQU 16 END OF FILE



*
* DEVICE DESCRIPTOR FORMAT
*

 ORG 0
DD.TOT RMB 3 TOTAL NUMBER OF SECTORS
DD.TKS RMB 1 TRACK SIZE IN SECTORS
DD.MAP RMB 2 NUMBER OF BYTES IN ALLOCATION BIT MAP
DD.BIT RMB 2 NUMBER OF SECTORS/BIT
DD.DIR RMB 3 ADDRESS OF ROOT DIRECTORY FD
DD.OWN RMB 2 OWNER
DD.ATT RMB 1 ATTRIBUTES
DD.DSK RMB 2 DISK ID
DD.FMT RMB 1 DISK FORMAT; DENSITY/SIDES
DD.SPT RMB 2 Sectors/Track
DD.RES RMB 2 RESERVED FOR FUTURE USE
DD.SIZ EQU . DEVICE DESCRIPTOR MINIMUM SIZE
DD.BT RMB 3 SYSTEM BOOTSTRAP SECTOR
DD.BSZ RMB 2 SIZE OF SYSTEM BOOTSTRAP
DD.DAT RMB 5 CREATION DATE
DD.NAM RMB 32 VOLUME NAME



*
* FILE DESCRIPTOR FORMAT
*

 ORG 0
FD.ATT RMB 1 ATTRIBUTES
FD.OWN RMB 2 OWNER
FD.DAT RMB 5 DATE LAST MODIFIED
FD.LNK RMB 1 LINK COUNT
FD.SIZ RMB 4 FILE SIZE
FD.SLE RMB 3 SEGMENT LIST EXTENSION
FD.SEG EQU . BEGINNING OF SEGMENT LIST

* SEGMENT LIST ENTRY FORMAT
 ORG 0
FDSL.A RMB 3 SEGMENT BEGINNING PHYSICAL SECTOR NUMBER
FDSL.B RMB 2 SEGMENT SIZE
FDSL.S EQU . SEGMENT LIST ENTRY SIZE

FD.LS1 EQU FD.SEG+((256-FD.SEG)/FDSL.S-1)*FDSL.S
FD.LS2 EQU (256/FDSL.S-1)*FDSL.S

MINSEC SET 16



*
* DIRECTORY ENTRY FORMAT
*

 ORG 0
DIR.NM RMB 29 FILE NAME
DIR.FD RMB 3 FILE DESCRIPTOR PHYSICAL SECTOR NUMBER
DIR.SZ EQU . DIECTORY RECORD SIZE


****************
*
*  STATIC STORAGE
*
*
* OVERALL DISK STATIC STORAGE
*
*  NOTE:  This does NOT reserve ANY memory for Drive Tables
*         Each Driver is responsible for reserving sufficient
*         memory for the appropriate number of tables.
*
 ORG V.USER RESERVE REQUIRED
V.NDRV RMB 1 NUMBER OF DRIVES
DRVBEG EQU . BEGINNING OF DRIVE TABLES
*
* GLOBAL STORAGE FOR DISK DRIVE TABLES
* EACH TABLE CONTAINS THE FIRST 'DD.SIZ' BYTES
* FROM SECTOR 0, AND THE CURRENT TRACK, STEPPING RATE,
* BIT-MAP USE FLAG, AND DISK TYPE
*
 ORG 0
 RMB DD.SIZ DEVICE DESCRIPTOR, SECTOR 0
V.TRAK RMB 2 CURRENT TRACK
V.BMB RMB 1 BIT-MAP USE FLAG
DRVMEM EQU .

 opt l



